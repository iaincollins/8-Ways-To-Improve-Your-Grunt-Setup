{"version":3,"file":"main.js","sources":["imager.js","main.js"],"names":[],"mappings":"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","sourcesContent":[";(function (window, document) {\n\n    'use strict';\n\n    var defaultWidths, getKeys, nextTick, addEvent;\n\n    nextTick = window.requestAnimationFrame ||\n               window.mozRequestAnimationFrame ||\n               window.webkitRequestAnimationFrame ||\n               function (callback) {\n                   window.setTimeout(callback, 1000 / 60);\n               };\n\n    function applyEach (collection, callbackEach) {\n        var i = 0,\n            length = collection.length,\n            new_collection = [];\n\n        for (; i < length; i++) {\n            new_collection[i] = callbackEach(collection[i], i);\n        }\n\n        return new_collection;\n    }\n\n    function returnDirectValue (value) {\n      return value;\n    }\n\n    addEvent = (function(){\n        if (document.addEventListener){\n            return function addStandardEventListener(el, eventName, fn){\n                return el.addEventListener(eventName, fn, false);\n            };\n        }\n        else {\n            return function addIEEventListener(el, eventName, fn){\n                return el.attachEvent('on'+eventName, fn);\n            };\n        }\n    })();\n\n    defaultWidths = [96, 130, 165, 200, 235, 270, 304, 340, 375, 410, 445, 485, 520, 555, 590, 625, 660, 695, 736];\n\n    getKeys = typeof Object.keys === 'function' ? Object.keys : function (object) {\n        var keys = [],\n            key;\n\n        for (key in object) {\n            keys.push(key);\n        }\n\n        return keys;\n    };\n\n\n    /*\n        Construct a new Imager instance, passing an optional configuration object.\n\n        Example usage:\n\n            {\n                // Available widths for your images\n                availableWidths: [Number],\n\n                // Selector to be used to locate your div placeholders\n                selector: '',\n\n                // Class name to give your resizable images\n                className: '',\n\n                // If set to true, Imager will update the src attribute of the relevant images\n                onResize: Boolean,\n\n                // Toggle the lazy load functionality on or off\n                lazyload: Boolean,\n\n                // Used alongside the lazyload feature (helps performance by setting a higher delay)\n                scrollDelay: Number\n            }\n\n        @param {object} configuration settings\n        @return {object} instance of Imager\n     */\n    function Imager (elements, opts) {\n        var self = this,\n            doc  = document;\n\n        opts = opts || {};\n\n        if (elements !== undefined) {\n            // first argument is selector string\n            if (typeof elements === 'string') {\n                opts.selector = elements;\n                elements = undefined;\n            }\n\n            // first argument is the `opts` object, `elements` is implicitly the `opts.selector` string\n            else if (typeof elements.length === 'undefined') {\n                opts = elements;\n                elements = undefined;\n            }\n        }\n\n        this.imagesOffScreen  = [];\n        this.viewportHeight   = doc.documentElement.clientHeight;\n        this.selector         = opts.selector || '.delayed-image-load';\n        this.className        = opts.className || 'image-replace';\n        this.gif              = doc.createElement('img');\n        this.gif.src          = 'data:image/gif;base64,R0lGODlhEAAJAIAAAP///wAAACH5BAEAAAAALAAAAAAQAAkAAAIKhI+py+0Po5yUFQA7';\n        this.gif.className    = this.className;\n        this.gif.alt          = '';\n        this.scrollDelay      = opts.scrollDelay || 250;\n        this.onResize         = opts.hasOwnProperty('onResize') ? opts.onResize : true;\n        this.lazyload         = opts.hasOwnProperty('lazyload') ? opts.lazyload : false;\n        this.scrolled         = false;\n        this.availablePixelRatios = opts.availablePixelRatios || [1, 2];\n        this.availableWidths  = opts.availableWidths || defaultWidths;\n        this.onImagesReplaced = opts.onImagesReplaced || function () {};\n        this.widthsMap        = {};\n        this.refreshPixelRatio();\n        this.widthInterpolator = opts.widthInterpolator || returnDirectValue;\n\n        if (typeof this.availableWidths !== 'function'){\n          if (typeof this.availableWidths.length === 'number') {\n            this.widthsMap = Imager.createWidthsMap(this.availableWidths, this.widthInterpolator);\n          }\n          else {\n            this.widthsMap = this.availableWidths;\n            this.availableWidths = getKeys(this.availableWidths);\n          }\n\n          this.availableWidths = this.availableWidths.sort(function (a, b) {\n            return a - b;\n          });\n        }\n\n\n\n        if (elements) {\n            this.divs = applyEach(elements, returnDirectValue);\n            this.selector = null;\n        }\n        else {\n            this.divs = applyEach(doc.querySelectorAll(this.selector), returnDirectValue);\n        }\n\n        this.changeDivsToEmptyImages();\n\n        nextTick(function(){\n            self.init();\n        });\n    }\n\n    Imager.prototype.scrollCheck = function(){\n        if (this.scrolled) {\n            if (!this.imagesOffScreen.length) {\n                window.clearInterval(this.interval);\n            }\n\n            this.divs = this.imagesOffScreen.slice(0); // copy by value, don't copy by reference\n            this.imagesOffScreen.length = 0;\n            this.changeDivsToEmptyImages();\n            this.scrolled = false;\n        }\n    };\n\n    Imager.prototype.init = function(){\n        this.initialized = true;\n        this.checkImagesNeedReplacing(this.divs);\n\n        if (this.onResize) {\n            this.registerResizeEvent();\n        }\n\n        if (this.lazyload) {\n            this.registerScrollEvent();\n        }\n    };\n\n    Imager.prototype.createGif = function (element) {\n        // if the element is already a responsive image then we don't replace it again\n        if (element.className.match(new RegExp('(^| )' + this.className + '( |$)'))) {\n            return element;\n        }\n\n        var gif = this.gif.cloneNode(false);\n\n        gif.width = element.getAttribute('data-width');\n        gif.setAttribute('data-src', element.getAttribute('data-src'));\n        gif.setAttribute('alt', element.getAttribute('data-alt') || this.gif.alt);\n\n        element.parentNode.replaceChild(gif, element);\n\n        return gif;\n    };\n\n    Imager.prototype.changeDivsToEmptyImages = function(){\n        var self = this;\n\n        applyEach(this.divs, function(element, i){\n            if (self.lazyload) {\n                if (self.isThisElementOnScreen(element)) {\n                    self.divs[i] = self.createGif(element);\n                } else {\n                    self.imagesOffScreen.push(element);\n                }\n            } else {\n                self.divs[i] = self.createGif(element);\n            }\n        });\n\n        if (this.initialized) {\n            this.checkImagesNeedReplacing(this.divs);\n        }\n    };\n\n    Imager.prototype.isThisElementOnScreen = function (element) {\n        // document.body.scrollTop was working in Chrome but didn't work on Firefox, so had to resort to window.pageYOffset\n        // but can't fallback to document.body.scrollTop as that doesn't work in IE with a doctype (?) so have to use document.documentElement.scrollTop\n        var offset = Imager.getPageOffset();\n        var elementOffsetTop = 0;\n\n        if (element.offsetParent) {\n            do {\n                elementOffsetTop += element.offsetTop;\n            }\n            while (element = element.offsetParent);\n        }\n\n        return (elementOffsetTop < (this.viewportHeight + offset)) ? true : false;\n    };\n\n    Imager.prototype.checkImagesNeedReplacing = function (images) {\n        var self = this;\n\n        if (!this.isResizing) {\n            this.isResizing = true;\n            this.refreshPixelRatio();\n\n            applyEach(images, function(image){\n                self.replaceImagesBasedOnScreenDimensions(image);\n            });\n\n            this.isResizing = false;\n            this.onImagesReplaced(images);\n        }\n    };\n\n    Imager.prototype.replaceImagesBasedOnScreenDimensions = function (image) {\n        var computedWidth, src;\n\n        computedWidth = typeof this.availableWidths === 'function' ? this.availableWidths(image)\n                                                                   : this.determineAppropriateResolution(image);\n\n        src = this.changeImageSrcToUseNewImageDimensions(image.getAttribute('data-src'), computedWidth);\n\n        image.src = src;\n    };\n\n    Imager.prototype.determineAppropriateResolution = function (image) {\n        return Imager.getClosestValue(image.clientWidth, this.availableWidths);\n    };\n\n    /**\n     * Updates the device pixel ratio value used by Imager\n     *\n     * It is performed before each replacement loop, in case a user zoomed in/out\n     * and thus updated the `window.devicePixelRatio` value.\n     *\n     * @api\n     * @since 1.0.1\n     */\n    Imager.prototype.refreshPixelRatio = function refreshPixelRatio(){\n        this.devicePixelRatio = Imager.getClosestValue(Imager.getPixelRatio(), this.availablePixelRatios);\n    };\n\n    Imager.prototype.changeImageSrcToUseNewImageDimensions = function (src, selectedWidth) {\n        return src\n            .replace(/{width}/g, Imager.transforms.width(selectedWidth, this.widthsMap))\n            .replace(/{pixel_ratio}/g, Imager.transforms.pixelRatio(this.devicePixelRatio));\n    };\n\n    Imager.getPixelRatio = function getPixelRatio(context){\n        return (context || window)['devicePixelRatio'] || 1;\n    };\n\n    Imager.createWidthsMap = function createWidthsMap (widths, interpolator) {\n        var map = {},\n            i   = widths.length;\n\n        while (i--) {\n            map[widths[i]] = interpolator(widths[i]);\n        }\n\n        return map;\n    };\n\n    Imager.transforms = {\n        pixelRatio: function (value) {\n            return value === 1 ? '' : '-' + value + 'x';\n        },\n        width: function (width, map) {\n            return map[width] || width;\n        }\n    };\n\n    /**\n     * Returns the closest upper value.\n     *\n     * ```js\n     * var candidates = [1, 1.5, 2];\n     *\n     * Imager.getClosestValue(0.8, candidates); // -> 1\n     * Imager.getClosestValue(1, candidates); // -> 1\n     * Imager.getClosestValue(1.3, candidates); // -> 1.5\n     * Imager.getClosestValue(3, candidates); // -> 2\n     * ```\n     *\n     * @api\n     * @since 1.0.1\n     * @param {Number} baseValue\n     * @param {Array.<Number>} candidates\n     * @returns {Number}\n     */\n    Imager.getClosestValue = function getClosestValue(baseValue, candidates){\n        var i             = candidates.length,\n            selectedWidth = candidates[i - 1];\n\n        while (i--) {\n            if (baseValue <= candidates[i]) {\n                selectedWidth = candidates[i];\n            }\n        }\n\n        return selectedWidth;\n    };\n\n    Imager.prototype.registerResizeEvent = function(){\n        var self = this;\n\n        addEvent(window, 'resize', function(){\n            self.checkImagesNeedReplacing(self.divs);\n        });\n    };\n\n    Imager.prototype.registerScrollEvent = function (){\n        var self = this;\n\n        this.scrolled = false;\n\n        this.interval = window.setInterval(function(){\n            self.scrollCheck();\n        }, self.scrollDelay);\n\n        addEvent(window, 'scroll', function(){\n            self.scrolled = true;\n        });\n    };\n\n    Imager.getPageOffsetGenerator = function getPageVerticalOffset(testCase){\n        if(testCase){\n            return function(){ return window.pageYOffset; };\n        }\n        else {\n            return function(){ return document.documentElement.scrollTop; };\n        }\n    };\n\n    // This form is used because it seems impossible to stub `window.pageYOffset`\n    Imager.getPageOffset = Imager.getPageOffsetGenerator(Object.prototype.hasOwnProperty.call(window, 'pageYOffset'));\n\n    // Exporting for testing purpose\n    Imager.applyEach = applyEach;\n\n    /* global module, exports: true, define */\n    if (typeof module === 'object' && typeof module.exports === 'object') {\n        // CommonJS, just export\n        module.exports = exports = Imager;\n    } else if (typeof define === 'function' && define.amd) {\n        // AMD support\n        define('imager',[],function () { return Imager; });\n    } else if (typeof window === 'object') {\n        // If no AMD and we are in the browser, attach to window\n        window.Imager = Imager;\n    }\n    /* global -module, -exports, -define */\n\n}(window, document));\n\n","require(['imager'], function (Imager) {\n\tvar imager = new Imager({\n        availableWidths: [320, 640, 1024]\n    });\n});\ndefine(\"main\", function(){});\n\n"]}